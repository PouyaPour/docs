 <!DOCTYPE html>
<html lang="fa">
<head>
    <title>مستندات وندار | ارایه دهنده راهکارهای پرداخت</title>
    <meta name="description" content="">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <meta name="format-detection" content="telephone=no">
    <link href="https://fonts.googleapis.com/css2?family=Markazi+Text&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.rtl.css">
    <link rel='icon' href='https://cdn.vandar.ir/public/logos/icon-logo.svg' type='image/x-icon' >
</head>
<body dir="rtl">
<header id="header">
    <h1>Vandar</h1>
    <h2>مستندات وندار</h2>
</header>

<div class="container">
    <div class="row">
        <div class="col-sm-3">
            <div id="myHeader">
                <ul>
                    <!--                <li>-->
                    <!--                    <a href="https://vandarpay.github.io/docs/" class="active">مفاهیم اولیه</a>-->
                    <!--                    &lt;!&ndash;                    <div class="sidenav">&ndash;&gt;-->
                    <!--                </li>-->

                    <li>
                        <button class="dropdown-btn">مفاهیم اولیه
                            <br>
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="dropdown-container">
                            <a href="https://vandarpay.github.io/docs/#postman">Postman</a><br>
                            <a href="https://vandarpay.github.io/docs/#start">شروع کنید</a><br>
                            <!--                        </div>-->
                        </div>
                    </li>
                    <li>
                        <button class="dropdown-btn">درگاه پرداخت
                            <br>
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="dropdown-container">
                            <a href="https://vandarpay.github.io/docs/ipg/#payment-gateways">ساخت و ویرایش درگاه پرداخت</a><br>
                            <a href="https://vandarpay.github.io/docs/ipg/#active-ipg">فعال کردن درگاه پرداخت</a><br>
                            <a href="https://vandarpay.github.io/docs/ipg/#implementation">پیاده سازی فنی درگاه پرداخت</a><br>
                            <a href="https://vandarpay.github.io/docs/ipg/#step-1">مرحله اول</a><br>
                            <a href="https://vandarpay.github.io/docs/ipg/#step-2">مرحله دوم</a><br>
                            <a href="https://vandarpay.github.io/docs/ipg/#step-3">مرحله سوم</a><br>
                            <a href="https://vandarpay.github.io/docs/ipg/#step-4">مرحله چهارم</a><br>
                            <!--                        </div>-->
                        </div>
                    </li>
                    <li>
                        <button class="dropdown-btn">دریافت توکن
                            <br>
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="dropdown-container">
                            <a href="https://vandarpay.github.io/docs/auth/#step-1">مرحله اول</a><br>
                            <!--                        </div>-->
                        </div>
                    </li>
                    <li>
                        <button class="dropdown-btn">کسب‌وکار
                            <br>
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="dropdown-container">

                            <a href="https://vandarpay.github.io/docs/business/#information">اطلاعات</a><br>
                            <a href="https://vandarpay.github.io/docs/business/#users">کاربران</a><br>
                            <!--                        </div>-->
                        </div>
                        <!--                        <a href="https://vandarpay.github.io/docs/business">کسب‌وکار</a>-->
                    </li>
                    <li>
                        <button class="dropdown-btn">صورت حساب
                            <br>
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="dropdown-container">
                            <a href="https://vandarpay.github.io/docs/invoice/#wallet">کیف پول</a><br>
                            <a href="https://vandarpay.github.io/docs/invoice/#transactions">صورت حساب</a><br>
                            <!--                        </div>-->
                        </div>
                    </li>
                    <li>
                        <button class="dropdown-btn">سرویس تسویه
                            <br>
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="dropdown-container">
                            <a href="https://vandarpay.github.io/docs/settlement/#settlements">لیست تسویه ها</a><br>
                            <a href="https://vandarpay.github.io/docs/settlement/#request-settlement">ثبت درخواست تسویه</a><br>
                            <a href="https://vandarpay.github.io/docs/settlement/#cancel">لغو یک تسویه</a><br>
                            <a href="https://vandarpay.github.io/docs/settlement/#health">لیست روش‌های پرداخت تسویه</a><br>
                            <!--                        </div>-->
                        </div>
                    </li>
                    <li>
                        <button class="dropdown-btn">  سرویس تسویه گروهی
                            <br>
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="dropdown-container">
                            <a href="https://vandarpay.github.io/docs/batch-settlement/#batch-settlements-intro">مقدمه</a><br>
                            <a href="https://vandarpay.github.io/docs/batch-settlement/#batch-settlements-index">لیست تسویه های گروهی</a><br>
                            <a href="https://vandarpay.github.io/docs/batch-settlement/#batch-settlements-show">جزییات یک تسویه گروهی</a><br>
                            <a href="https://vandarpay.github.io/docs/batch-settlement/#batch-settlement-store">ثبت یک تسویه گروهی</a><br>
                        </div>
                    </li>
                    <li>
                        <button class="dropdown-btn">سرویس پرداخت خودکار
                            <br>
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="dropdown-container">
                            <a href="https://vandarpay.github.io/docs/subscription/#mpg">مقدمه</a><br>
                            <a href="https://vandarpay.github.io/docs/subscription/#banks">دریافت لیست روش‌های پرداخت‌</a><br>
                            <a href="https://vandarpay.github.io/docs/subscription/#get-token">سرویس دریافت توکن</a><br>
                            <a href="https://vandarpay.github.io/docs/subscription/#withdrawal">سرویس برداشت وجه</a><br>
                            <a href="https://vandarpay.github.io/docs/subscription/#error">لیست خطاهای دریافتی</a><br>
                            <a href="https://vandarpay.github.io/docs/subscription/better-product-design/" target="_blank">طراحی محصولی بهتر</a><br>
                            <!--                        </div>-->
                        </div>
                    </li>
                    <li>
                        <button class="dropdown-btn">سرویس پرداخت با وندار
                            <br>
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="dropdown-container">
                            <a href="https://vandarpay.github.io/docs/pay-by-vandar/#overview">معرفی سرویس</a><br>
                            <a href="https://vandarpay.github.io/docs/pay-by-vandar/#intro">مقدمه</a><br>
                            <a href="https://vandarpay.github.io/docs/pay-by-vandar/#send">دریافت توکن</a><br>
                            <a href="https://vandarpay.github.io/docs/pay-by-vandar/#redirect">انتقال کاربر</a><br>
                            <a href="https://vandarpay.github.io/docs/pay-by-vandar/#inquiry">استعلام</a><br>
                            <a href="https://vandarpay.github.io/docs/pay-by-vandar/#verify">تایید</a><br>
                        </div>
                    </li>
                    <li>
                      <button class="dropdown-btn">سرویس مشتریان
                          <br>
                          <i class="fa fa-caret-down"></i>
                      </button>
                      <div class="dropdown-container">
                          <a href="https://vandarpay.github.io/docs/customers/#customers">مقدمه</a><br>
                          <a href="https://vandarpay.github.io/docs/customers/#base">مشتریان</a><br>
                          <a href="https://vandarpay.github.io/docs/customers/#wallet">کیف پول</a><br>
                          <a href="https://vandarpay.github.io/docs/customers/#transactions">تراکنش</a><br>
                          <a href="https://vandarpay.github.io/docs/customers/#sheba">شبا</a><br>
                          <a href="https://vandarpay.github.io/docs/customers/#card">کارت</a><br>
                          <a href="https://vandarpay.github.io/docs/customers/#authentication">احراز هویت</a><br>
                          <a href="https://vandarpay.github.io/docs/customers/#logs">گزارشات</a><br>
                          <a href="https://vandarpay.github.io/docs/customers/#cash-in-code">شناسه پرداخت</a><br>
                      </div>
                  </li>
                    <li>
                        <button class="dropdown-btn">سرویس معاملات امن
                            <br>
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="dropdown-container">
                            <a href="https://vandarpay.github.io/docs/miando/#intro">مقدمه</a><br>
                            <a href="https://vandarpay.github.io/docs/miando/#customers">مشتریان</a><br>
                            <a href="https://vandarpay.github.io/docs/miando/#agreements">معاملات</a><br>
                            <a href="https://vandarpay.github.io/docs/miando/#tickets">تیکت ها</a><br>
                            <a href="https://vandarpay.github.io/docs/miando/#webhooks">وبهوک</a><br>
                        </div>
                    </li>
					<li>
						<button class="dropdown-btn">ابزار واریز روش‌های پرداختی
							<br>
							<i class="fa fa-caret-down"></i>
						</button>
						<div class="dropdown-container">
							<a href="https://vandarpay.github.io/docs/cash-in/#intro">مقدمه</a><br>
							<a href="https://vandarpay.github.io/docs/cash-in/#ibans-list">لیست شماره شباها</a><br>
							<a href="https://vandarpay.github.io/docs/cash-in/#get-balance">دریافت موجودی حساب</a><br>
							<a href="https://vandarpay.github.io/docs/cash-in/#deposit">درخواست واریز</a><br>
						</div>
					</li>
                    <li>
                        <a href="https://vandarpay.github.io/docs/refund">بازگشت وجه</a>
                    </li>
                    <li>
                        <a href="https://vandarpay.github.io/docs/banks">روش‌های پرداخت‌</a>
                    </li>
                    <li>
                        <a href="https://vandarpay.github.io/docs/errors">خطا‌ها</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="col-sm-9">
            <article class="content">
                <div class="article" id="ipg">

                    <div>
                        آخرین تغییرات: ۱۴۰۰/۱۰/۱۰
                    </div>

                    <h2 class="article-header">مقدمه</h2>
                    <div>
                        <h3 class="title" id="mpg">
                          <a href="#mpg" > <strong>سرویس پرداخت آزاد چیست:</strong></a>
                        </h3>
                        <!--todo: description-->
                        <p>سرویس پرداخت خودکار یا دایرکت دبیت سرویسی است که یک فرد وجوهی را از حساب روش‌های پرداختی شخص دیگری خارج میکند در واقع شما به روش‌های پرداخت اجازه میدهید که مبلغی را مستقیما   از حسابتان کسر و در قبال آن خدماتی را به شما  ارایه دهد. به طور کلی دایرت دبیت برداشت مستقیم پول برای انجام معاملات مالی در صورت صدور مجوز توسط پرداخت کننده می باشد. این کار بیشتر زمانی انجام می شود که شما بخواهید اشتراک خود را تمدید کنید.

                            شما می توانید در وندار به وسیله این API پرداخت خودکار حساب های خود را مدیریت کنید.
                            تمامی API های وندار بر اساس معماری REST پیاده سازی شده و آدرس آن به شرح زیر می باشد:
                            </p>
                        <p>برای تمامی درخواست های ارسالی باید مقادیر زیر در هدر ارسال شوند:
                            توکن همان کلید API یی است که از وندار دریافت کرده اید.
                            </p>
                        <pre>
<span class="key">Accept:</span> application/json
<span class="key">x-api-key:</span> {api-key}
                        </pre>
                        <br>
                        <h2 class="article-header" id="banks">
                            <a href="#banks">دریافت لیست روش‌های پرداخت</a> </h2>
                        <p>لیست روش های پرداخت قابل استفاده از این بخش قابل دسترس می‌باشد.
                            می‌توانید بر اساس نیازمندی کسب‌وکار خود کلیه روش‌های پرداخت فعال را به کاربران ارائه دهید و یا در صورت نیاز یک لیست شخصی‌سازی شده برای کسب‌وکار خود ایجاد کنید و لیست تعیین شده‌ای از روش‌های پرداخت را در اختیار کاربران خود قرار دهید.
                        </p>
                        <h3 class="title" id="custom-payment-methods"><a href="#custom-payment-methods">
                            ۱. لیست شخصی‌سازی شده روش‌های پرداخت
                        </a>
                        </h3>
                        <p>
                            این امکان برای شما وجود دارد که از میان همه روش‌های پرداختی که در حال حاضر قابلیت ارائه سرویس پرداخت دارند، بر اساس نیاز خود، روش‌های پرداختی را فعال یا غیرفعال کنید.
                            بصورت پیش‌فرض کلیه روش‌های پرداخت‌ برای کسب‌وکار شما فعال می‌باشند و با فراخوانی سرویس لیست روش‌های پرداخت‌ می‌توانید اطلاعات روش‌های پرداخت و همچنین وضعیت در دسترس بودن روش‌های پرداخت را دریافت نمایید.
                            در صورتی که بخواهید روش‌های پرداختی خاصی را از لیست روش‌های پرداخت‌ی دریافتی حذف نمایید می‌توانید از طریق داشبورد وندار، بخش پرداخت آزاد، اقدام نمایید.
                        </p>
                        </br>
                        <p>
                            جهت فعال یا غیرفعال‌سازی روش‌های پرداخت‌ می‌توانید از بخش مدیریت اقدام نمایید.
                        </p>


                        <p>
                            جهت فراخوانی سرویسی که لیست روش‌های پرداخت‌ی فعال کسب‌وکار شما را نمایش می‌دهد، آدرس زیر را فراخوانی کنید.
                        </p>
                        <pre>
<span class="key">Method:</span>  GET
<span class="key">Address:</span> https://api.vandar.io/mpg/v1/business-payment-methods
                        </pre>
                        </br>
                        <h3 class="sub-title">
                            پارامترهای مجاز
                        </h3>
                        <table class="table">
                            <thead>
                            <tr>
                                <th>name</th>
                                <th>Type</th>
                                <th>Status</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>mobile</td>
                                <td>string</td>
                                <td>optional</td>
                            </tr>
                            <tr>
                                <td>modes</td>
                                <td>array</td>
                                <td>optional</td>
                            </tr>
                            <tr>
                                <td>types</td>
                                <td>array</td>
                                <td>optional</td>
                            </tr>
                            <tr>
                                <td>limit</td>
                                <td>numeric</td>
                                <td>optional</td>
                            </tr>
                            <tr>
                                <td>is_healthy</td>
                                <td>boolean</td>
                                <td>optional</td>
                            </tr>

                            </tbody>
                        </table>
                        <h3 class="sub-title">
                            توضیحات
                        </h3>
                        <ul>
                            <li>
                                mobile (اختیاری): شماره موبایل کاربر. شماره موبایل بدون کد کشور و به فرمت 09123456789 باشد.
                            </li>
                            <div class="info">
                                <strong>نکته! </strong>
                                <span>
                                    اگر موبایل  در درخواست مربوطه ارسال گردد، و روش پرداخت از نوع debit باشد، لیست مجوزهای فعال مربوط به آن شماره موبایل نیز در پاسخ دریافتی قرارخواهد گرفت.(در نمونه پاسخ دریافتی میتوانید مشاهده کنید.)
                                </span>
                            </div>
                            <br>
                            <li>modes (اختیاری): این کلید به مدل پرداخت مربوط است. هر مقداری وارد شود، بر اساس مقدار وارد شده لیست روش های پرداخت فیلتر می‌شود.</li>
                            <div class="info">
                                <strong>نکته! </strong>
                                <span>
                                    در حال حاضر این سرویس دو مدل پرداخت را پشتیبانی میکند:
                                </span>
                                <ul>
                                    <li>
                                         once : جهت پرداخت یک باره
                                    </li>
                                </ul>
                            </div>
                            <br>
                            <li>types (اختیاری): این کلید به نوع روش پرداخت مربوط است. هر مقداری وارد شود، بر اساس مقدار وارد شده لیست روش های پرداخت فیلتر می‌شود.</li>
                            <div class="info">
                                <strong>نکته! </strong>
                                <span>
                                    در حال حاضر این سرویس یک مدل پرداخت را پشتیبانی میکند:
                                </span>
                                <ul>
                                    <li>
                                        debit : پرداخت از حساب
                                    </li>
                                </ul>
                            </div>
                            <br>
                            <li>limit (اختیاری): هر روش پرداختی محدودیت سقف برداشت دارد. درصورت وارد کردن این کلید، روش‌های پرداخت بر اساس حداقل مقدار وارد شده فیلتر می‌شود.</li>
                            <li>is_healthy (اختیاری): هر روش پرداختی بنابر دلایل مختلف ممکن است به صورت موقت آماده به ارائه خدمات نباشد. درصورت وارد کردن این کلید  ، روش‌های پرداخت بر اساس  مقدار وارد شده فیلتر می‌شود.</li>
                        </ul>
                        <h3 class="sub-title">
                            نمونه json
                        </h3>
                        <pre>
{
    "mobile": "09354614194",
    "modes": [
        "once"
    ],
    "types": [
        "debit"
    ],
    "limit": 3000000,
    "is_healthy": true
}
                        </pre>
                        <h3 class="sub-title">
                            نمونه پاسخ دریافتی موفق:
                        </h3>

                        <pre>
<span class="key">HTTP/1.1</span> 200
{
    "message": "لیست متد های پرداخت."
    "data": [
        {
            "modes": [
                   "once"
            ],
            "slug": "debit-saman",
            "type": "debit",
            "name": "بانک سامان",
            "logo": "https://cdn.vandar.io/mpg/payment_methods/debit-saman.svg",
            "is_healthy": true,
            "limit": 4270045,
            "debit": {
                "mandates": [
                    {
                        "id": "1408bf10-2dcd-11ed-b084-bb5348c5e321",
                        "count": 30,
                        "limit": 30000000,
                        "payment_method_slug": "debit-saman",
                        "status": "ACTIVE",
                        "expiration_date": "2022-11-09",
                        "customer_id": "efdaf820-2075-11ed-a96b-a9167c05d45d",
                        "created_at": 1662452234,
                        "updated_at": 1662452234,
                        "revoked_at": null
                    }
                ]
            }
        }
    ]
}
                        </pre>

                        </pre>
                        <br>
                        <h2 class="article-header" id="get-token">
                        <a href="#get-token">صدور مجوز در روش پرداخت از حساب</a> </h2>

                        <h3 class="title" id="subscription"><a href="#subscription">
                            ۱. درخواست بستن مجوز:
                        </a>

                        </h3>
                        <p>اولین مرحله برای بستن مجوز برداشت از حساب، ثبت درخواست صدور مجوز است. لازم است که درخواست خود را به آدرس زیر ارسال کنید.</p>
                        <pre>
<span class="key">Method:</span> POST
<span class="key">Address:</span> https://api.vandar.io/mpg/v1/mandates/store
                        </pre>
                        <h3 class="sub-title">
                          پارامترهای مجاز
                        </h3>
                        <table class="table">
                          <thead>
                          <tr>
                              <th>name</th>
                              <th>Type</th>
                              <th>Status</th>
                          </tr>
                          </thead>
                          <tbody>
                          <tr>
                              <td>payment_method</td>
                              <td>string</td>
                              <td>required</td>
                          </tr>
                          <tr>
                              <td>count</td>
                              <td>integer</td>
                              <td>required</td>
                          </tr>
                          <tr>
                              <td>limit</td>
                              <td>integer</td>
                              <td>required</td>
                          </tr>
                          <tr>
                              <td>expiration_date</td>
                              <td>date</td>
                              <td>required</td>
                          </tr>
                          <tr>
                              <td>callback_url</td>
                              <td>string</td>
                              <td>required</td>
                          </tr>
                          <tr>
                              <td>customer.mobile</td>
                              <td>string</td>
                              <td>required</td>
                          </tr>
                          <tr>
                            <td>customer.email</td>
                            <td>string</td>
                            <td>optional</td>
                          </tr>
                          <tr>
                              <td>customer.first_name</td>
                              <td>string</td>
                              <td>optional</td>
                          </tr>
                          <tr>
                              <td>customer.last_name</td>
                              <td>string</td>
                              <td>optional</td>
                          </tr>
                        </tbody>
                      </table>
                      <h3 class="sub-title">
                        توضیحات
                      </h3>
                        <ul>
                          <li>payment_method: (اجباری) slug روش‌ پرداخت که از لیست روش های پرداخت قابل استفاده است.</li>
                          <li>count (اجباری): حداکثر تعداد دفعاتی که در یک ماه می‌توان با این مجوز، برداشت وجه موفق انجام داد.</li>
                          <li>limit (اجباری): حداکثر مبلغ وجه قابل برداشت در هر درخواست مربوط به این مجوز. واحد پول ریال است.</li>
                          <li>expiration_date: (اجباری) تاریخ انقضای مجوز. این تاریخ باید بزرگتر از تاریخ روز جاری باشد و به صورت میلادی وارد می‌شود.</li>
                          <li>callback_url (اجباری): باید با آدرس درگاه پرداخت تایید شده در وندار بر روی یک دامنه باشد</li>
                          <li>customer.mobile (اجباری): شماره موبایل کاربر. شماره موبایل بدون کد کشور و به فرمت 09123456789 باشد.</li>
                          <li>customer.email (اختیاری): ایمیل کاربر که بهتر است برای پیگیری‌های بعدی ارسال شود.</li>
                          <li>customer.first_name (اختیاری): نام کاربر که بهتر است برای پیگیری‌های بعدی ارسال شود</li>
                          <li>customer.last_name (اختیاری): نام‌خانوادگی کاربر که بهتر است برای پیگیری‌های بعدی ارسال شود</li>
                        </ul>
                        <h3 class="sub-title">
                          نمونه json
                        </h3>
                        <pre>
{
  "payment_method": "debit-saman",
  "count": 7,
  "limit": 10000,
  "expiration_date": "2023-03-03",
  "callback_url": "https://paperpiano.ir/mandate/callback",
  "customer": {
    "mobile": "09123456789",
    "email": "yourcustomer@gmail.com",
    "first_name": "محمد",
    "last_name": "مقصودی",
  }
}
                        </pre>
                        <h3 class="sub-title">
                          نمونه پاسخ دریافتی موفق:
                        </h3>

                        <pre>
<span class="key">HTTP/1.1</span> 200
{
  "status": 1,
  "message": "درخواست توکن با موفقیت ثبت شد.",
  "data": {
      "token": "0cf235d0-d48b-11ea-86cd-298ec898a9bd",
        "customer": {
            "mobile": "09123456789",
            "first_name": "محمد",
            "last_name": "مقصودی",
            "email": "yourcustomer@gmail.com",
      }
    }
  }
}
                        </pre>
                        <div class="info">
                          <strong>نکته! </strong>
                          token دریافتی در این قسمت یکبار مصرف است و پس از ۲۰ دقیقه باطل می شود.
                        </div>
                        <ul>
                          <li>message: پیغام درخواست توکن با موفقیت ثبت شد.</li>
                          <li>
                            data:
                            <ul>
                              <li>token: آیدی شما در سرویس پرداخت خودکار که باید درخواست های بعدی خود را با این آیدی ارسال کنید.</li>
                            </ul>
                            <ul>
                              <li>
                                  customer:
                                  <ul>
                                      <li>mobile: شماره موبایل کاربر</li>
                                      <li>first_name: نام کاربر</li>
                                      <li>last_name: نام‌خانوادگی کاربر</li>
                                      <li>email: ایمیل کاربر</li>
                                  </ul>
                              </li>
                            </ul>
                          </li>
                        </ul>
                      <h3 class="title" id="transfer">
                       <a href="#transfer"> ۲. انتقال کاربر به صفحه تایید صدور مجوز</a>
                      </h3>
                      <p>
                        در مرحله بعد token دریافتی از قسمت قبل را در انتهای
                         آدرس
                        می گذارید و در مرورگر وارد سایت می شوید.
                      </p>
                      <pre>
<span class="key">METHOD:</span> get
<span class="key">URL:</span> https://mpg.vandar.io/mandate/{token}
                      </pre>

                        <p>
                            در صورتی که در ارتباط با روش‌های پرداخت اختلال پیش آمده باشد شما با آدرس زیر روبرو می‌شوید:
                        </p>
<pre>
https://yourdomain.com/callback?token=0cf235d0-d48b-11ea-86cd-298ec898a9bd&status=FAILED_TO_ACCESS_BANK
</pre>
                        <ul>
                            <li>
                                token: توکنی که با استفاده از آن تلاش کرده‌اید تا به صفحه‌ی روش‌های پرداخت منتقل شوید.
                            </li>
                        </ul>
                        <p>
                            در صورتی که با موفقیت به صفحه‌ی روش‌های پرداخت وارد شوید، با صفحه‌ای مشابه با صفحه‌ی زیر مواجه خواهید شد:
							در این مرحله اطلاعات حسابی که کاربر می خواهد بر روی آن دسترسی بدهد باید وارد شود. شماره موبایلی که در این قسمت ارسال می شود باید متعلق به صاحب حساب باشد.


                        </p>
<!-- todo renew images -->
                        <p style=" text-align: center">
<img src="../images/ayandeh-mandate-step1.png"  style="max-width: 500px;" alt="صفحه ورود روش‌های پرداخت">
                        </p>
<p>با وارد کردن اطلاعات کارت وارد صفحه زیر می شوید.</p>
                        <p style=" text-align: center">

                            <img src="../images/ayandeh-mandate-step2.png" style="max-width: 500px;" alt="صفحه دسترسی">
                        </p>
<h3 class="title" id="subscription-code">
  <a href="#subscription-code">۳. دریافت کد اشتراک</a>
</h3>
<p>در صورتی که کاربر بر روی دکمه دسترسی دارد کلیک کند، وندار کاربر را به آدرس برگشتی که در مرحله اول ارسال کرده‌اید به همراه پارامتر token و status و mandate_id هدایت می‌کند.

</p>

<p>در صورت اجازه‌ی دسترسی به حساب در صفحه‌ی روش‌های پرداخت</p>
<pre>
https://yourdomain.com/callback?token=0cf235d0-d48b-11ea-86cd-298ec898a9bd&mandate_id=9f307e30-dc77-11ea-830e-7533ca1787c5&status=SUCCEED
</pre>

<p>در صورت عدم اجازه‌ی دسترسی به حساب در صفحه‌ی روش‌های پرداخت</p>
<pre>
https://yourdomain.com/callback?token=0cf235d0-d48b-11ea-86cd-298ec898a9bd&status=FAILED&error_code=21
</pre>

        <ul>
                <li>
                    token: توکنی که با استفاده از آن تلاش کرده‌اید تا به صفحه‌ی روش‌های پرداخت منتقل شوید.
                </li>
                <li>
                    error_code: کد خطایی که به دلیل آن این درخواست ناموفق بوده است که می توانید با استفاده از جدول زیر توضیحات هر کد را ببینید.
                </li>
        </ul>

              <table class="table" style="direction: ltr;" id="tempAuthorization_errors_table">
                                    <thead>
                                    <tr>
                                        <th style="text-align: center;">error_code</th>
                                        <th style="text-align: center;">error_message</th>
                                    </tr>
                                    </thead>
                                </table>

              <h3 class="title" id="subscription-verify"><a href="#subscription-verify">
                ۴. تایید اشتراک
            </a>

            </h3>

            <p>درصورتی که کاربر اجازه دسترسی به مجوز را صادر کرده باشد، باید مجوز ایجاد شده را از طریق ارسال mandate_id به وندار تایید کنید. برای جلوگیری از تغییر وضعیت مجوزهای پیشین، وندار تنها یک بار اجازه تایید مجوز را به API می‌دهد.</p>
            <pre>
<span class="key">Method:</span> PUT
<span class="key">Address:</span> https://api.vandar.io/mpg/v1/mandate/{mandate_id}/verify</pre>
          </pre>
          <div class="info">
            <strong>نکته! </strong>
             وندار به جهت جلوگیری از ایجاد مجوز رهاشده، مجوزهایی که پس از ۲۰ دقیقه تایید نشوند را به شکل خودکار لغو می‌کند.
          </div>
            <h3 class="sub-title">
              نمونه پاسخ دریافتی موفق:
            </h3>

            <pre>
<span class="key">HTTP/1.1</span> 200
{
    "message": "مجوز با موفقیت تایید شد",
    "data": {
        "mandate": {
            "id": "068bb9f0-5ddf-11ed-b16d-61da2281b3d4",
            "count": 15,
            "limit": 100000,
            "payment_method_slug": "debit-ayandeh",
            "status": "ACTIVE",
            "expiration_date": "2022-11-09",
            "customer_id": "9da2e7f0-9de1-11ec-a6bc-978fb3b88c9d",
            "created_at": 1667744798,
            "updated_at": 1672579535,
            "revoked_at": null
        }
    }
}
            </pre>
          <h3 class="sub-title">
            نمونه پاسخ دریافتی نا موفق:
          </h3>
          <pre>
<span class="key">HTTP/1.1</span> 403
{
    "message": "مجاز به انجام این کار نیستید",
    "code": "mandate_already_revoked"
}
            </pre>
                        <pre>
<span class="key">HTTP/1.1</span> 403
{
    "message": "مجاز به انجام این کار نیستید",
    "code": "mandate_already_activated"
}
            </pre>
<h3 class="title" id="subscriptions">
 <a href="#subscriptions"> ۵. لیست مجوزها</a>
</h3>
<p>در این بخش  شما می توانید لیست مجوزهای ایجاد شده را مشاهده کنید.</p>
<pre>
<span class="key">METHOD:</span> GET
<span class="key">URL:</span> https://api.vandar.io/mpg/v1/mandates
</pre>

<h3 class="sub-title">
    پارامترهای مجاز
</h3>

<table class="table" dir="rtl">
    <thead>
    <tr>
        <th>name</th>
        <th>Type</th>
        <th>Status</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td>page</td>
        <td>numeric</td>
        <td>optional</td>
    </tr>
    <tr>
        <td>per_page</td>
        <td>numeric</td>
        <td>optional</td>
    </tr>
    </tbody>
</table>
                        </h3>
                        <ul>
                            <li>
                                page (اختیاری): شماره صفحه.
                            </li>
                            <li>per_page (اختیاری): تعداد آیتم در هر صفحه.</li>
                        </ul>
                        <h3 class="sub-title">
                            نمونه json
                        </h3>
                        <pre>
{
    "page": 1,
    "per_page":12
}
 </pre>
<h3 class="sub-title">
  نمونه پاسخ دریافتی موفق:
</h3>
<pre>
<span class="key">HTTP/1.1</span> 200
{
    "message": "لیست مجوزهای کسب و کار",
    "data": [
        {
            "id": "068bb9f0-5ddf-11ed-b16d-61da2281b3d4",
            "count": 15,
            "limit": 100000,
            "payment_method_slug": "debit-ayandeh",
            "status": "REVOKED",
            "expiration_date": "2022-11-09",
            "customer_id": "9da2e7f0-9de1-11ec-a6bc-978fb3b88c9d",
            "created_at": 1667741198,
            "updated_at": 1667741493,
            "revoked_at": 1667741493
        },
        {
            "id": "7bebd4b0-5a7a-11ed-a48b-d349deb0a60a",
            "count": 5,
            "limit": 50000,
            "payment_method_slug": "debit-saman",
            "status": "ACTIVE",
            "expiration_date": "2022-11-09",
            "customer_id": "4c12b5c0-1323-11ed-88aa-1d355b7661f1",
            "created_at": 1667368162,
            "updated_at": 1667368266,
            "revoked_at": null
        },
    ],
    "meta": {
        "current_page": 1,
        "from": 1,
        "last_page": 1,
        "per_page": 12,
        "to": 2,
        "total": 2
    }
}
</pre>
<ul>
  <li>
    data:
    <ul>
      <li>id: شناسه مجوز که برای درخواست برداشت وجه از این شناسه استفاده می شود.</li>
      <li>count: رشته عددی مشخص کننده تعداد درخواست های برداشت وجه که به صورت ماهانه مشخص می‌شود.</li>
      <li>limit: رشته عددی مشخص کننده حداکثر مبلغ برداشت وجه در هر برداشت. واحد پول ریال است.</li>
      <li>payment_method_slug: کد روش‌ پرداخت که به لیست آن در بالا اشاره شده است.</li>
      <li>status: وضعیت مجوز.</li>
      <li>expiration_date: تاریخ انقضای مجوز.</li>
      <li>customer_id: شناسه مشتری مربوط به این مجوز.</li>
      <li>created_at: تاریخ ایجاد مجوز.</li>
      <li>updated_at: تاریخ آخرین بروزرسانی مجوز</li>
      <li>revoked_at: تاریخ لغو مجوز.</li>
    </ul>
  </li>
  <li>
    meta:
    <ul>
      <li>current_page: آدرس همین صفحه</li>
      <li>from: شماره اولین آیتم که در این صفحه آمده است </li>
      <li>last_page: تعداد کل صفحات</li>
      <li>per_page: تعداد آیتم در هر صفحه</li>
      <li>to: شماره آخرین آیتمی که در این صفحه آمده است</li>
      <li>total: تعداد کل آیتم ها</li>
    </ul>
  </li>
</ul>
<div class="info">
  <strong>نکته! </strong>
     در این قسمت در خروجی id را دریافت میکنیم که در مراحل بعد برای استفاده از متد show و revoke و verify که برای نمایش و پاک کردن و تایید مجوز است مورد استفاده قرار میگیرد.
</div>
<h3 class="sub-title">
  نمونه پاسخ دریافتی نا موفق:
</h3>
<pre>
<span class="key">HTTP/1.1</span> 401
{
    "message": "احراز هویت انجام نشده است",
    "code": "unauthenticated_error"
}
  </pre>
  <ul>
    <li>message: پیغام خطا</li>
    <li>code: کد خطا</li>
  </ul>
<h3 class="title" id="show">
<a href="#show">  ۶. نمایش یک مجوز با id </a>
</h3>
<p>شما می توانید با این دستور جزییات یک مجوز را با فرستادن id دریافت کنید.</p>
<pre>
<span class="key">Method:</span> GET
<span class="key">Address:</span> https://api.vandar.io/mpg/v1/mandates/{id}
</pre>
<p>پارامتر {id} همان شناسه مجوز مربوطه است.</p>
<h3 class="sub-title">
  نمونه پاسخ دریافتی موفق:
</h3>
<pre>
<span class="key">HTTP/1.1</span> 200
{
    "message": "مجوز کسب و کار",
    "data": {
        "mandate": {
            "id": "068bb9f0-5ddf-11ed-b16d-61da2281b3d4",
            "count": 15,
            "limit": 100000,
            "payment_method_slug": "debit-ayandeh",
            "status": "REVOKED",
            "expiration_date": "2022-11-09",
            "customer_id": "9da2e7f0-9de1-11ec-a6bc-978fb3b88c9d",
            "created_at": 1667741198,
            "updated_at": 1667741493,
            "revoked_at": 1667741493
        }
    }
}
</pre>

<h3 class="title" id="delete">
 <a href="#delete">۷. پاک کردن یک مجوز برداشت از حساب با استفاده از id</a>
</h3>

<pre>
<span class="key">Method:</span> DELETE
<span class="key">Address:</span> https://api.vandar.io/mpg/v1/mandates/{id}
</pre>

<p>پارامتر {id} همان id مربوط به مجوز برداشت از حسابی است که قصد حذف آن را دارید.</p>

<h3 class="sub-title">
  نمونه پاسخ دریافتی موفق:
</h3>
<pre>
<span class="key">HTTP/1.1</span> 200
{
  "status": 1,
  "message": "مجوز کسب و کار با موفقیت لغو شد.",
  "data": {
    "mandate": {
      "id": "58ffbb2d-2a64-336d-b7c5-d5982eabf658",
      "count": 2,
      "limit": 800000,
      "payment_method_slug": debit-saman,
      "status": "REVOKED",
      "expiration_date": "2022-11-09",
      "customer_id": "f02ba3c5-6235-3601-981e-87094ac2365c",
      "created_at": 1664719213,
      "updated_at": 1672495213,
      "revoked_at": 1672495213,
    }
  }
}
</pre>
<ul>
  <li>message: پیغام مجوز کسب و کار با موفقیت لغو شد.</li>
  <li>
    data:
    <ul>
      <li>mandate:
        <ul>
          <li>id: آیدی مجوز حذف شده </li>
          <li>count: حداکثر تعداد دفعاتی که در یک ماه می‌ شد با مجوز حذف شده برداشت انجام شود.</li>
          <li>limit: حداکثر مبلغ وجه قابل برداشت با مجوز حذف شده.</li>
          <li>payment_method_slug: slug روش‌ پرداخت </li>
          <li>status: وضعیت مجوز</li>
          <li>expiration_date:  تاریخ انقضای مجوز</li>
          <li>callback_url: آدرس بازگشتی درگاه پرداخت تایید شده در وندار</li>
          <li>customer_id: آیدی کاربری که مجوز برای او صادر شده بود.</li>
          <li>created_at: تاریخ ایجاد به صورت timestamp</li>
          <li>updated_at: تاریخ آخرین بروزرسانی به صورت timestamp</li>
          <li>revoked_at: تاریخ حذف به صورت timestamp</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<div class="info">
  <strong> نکته! </strong>
  بعد از لغو یک مجوز این مجوز از خروجی لیست مجوزها حذف شده و اگر درخواست نمایش مجوز با آیدی را صدا بزنید خطای ۴۲۲ با متن مجوز باطل شده است را دریافت می کنید.
</div>

<br>
  <footer id="footer">
    <div class="container">
        <div class="row" style="text-align: center">
            <div class="col-sm-8 col-xs-6 no-padding-bottom">
                <a href="https://github.com/vandarpay/docs" target="_blank">مخزن گیت‌هاب</a>
            </div>
            <div class="col-sm-4 col-xs-6 text-right no-padding-bottom">2020 &copy; <a href="https://vandar.io" target="_blank">وندار</a></div>
        </div>
    </div>

</footer>
<button onclick="goTop()" id="go_top" title="Go to top">^</button>
<script>
    /* Loop through all dropdown buttons to toggle between hiding and showing its dropdown content - This allows the user to have multiple dropdowns without any conflict */
    var dropdown = document.getElementsByClassName("dropdown-btn");
    var i;

    for (i = 0; i < dropdown.length; i++) {
        dropdown[i].addEventListener("click", function () {
            this.classList.toggle("active");
            var dropdownContent = this.nextElementSibling;
            if (dropdownContent.style.display === "block") {
                dropdownContent.style.display = "none";
            } else {
                dropdownContent.style.display = "block";
            }
        });
    }


    var header = document.getElementById("myHeader");
    var sticky = header.offsetTop;

    window.onscroll = function () {
        var top = document.getElementById("go_top");
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            top.style.display = "block";
        } else {
            top.style.display = "none";
        }
        if (window.pageYOffset  > 320) {
            header.classList.add("fix-sidebar");
        } else {
            header.classList.remove("fix-sidebar");
        }

    };

    function goTop() {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    }

    fetch('https://health.vandar.io/subscription')
      .then(function(response) {
        return response.json();
      })
      .then(function(jsonResponse) {

        var banksHealthResponse = jsonResponse;

        var table = document.getElementById("banks_table");
        var banks = banksHealthResponse["result"]["banks"];

        for (var i = 0; i < banks.length ; i++)  {
            if (banks[i]["is_healthy_on_direct_debit"]) {
                var row = table.insertRow(-1);
                var bankName = row.insertCell(0);
                var bankCode = row.insertCell(1);
                var bankIsHealthyDirectDebit = row.insertCell(2);

                bankName.innerHTML = banks[i]["name"];
                bankCode.innerHTML = banks[i]["code"];
                bankIsHealthyDirectDebit.innerHTML = "سالم";
                bankIsHealthyDirectDebit.style.color = "green";
                bankName.style['text-align'] = 'center';
                bankCode.style['text-align'] = 'center';
                bankIsHealthyDirectDebit.style['text-align'] = 'center';
            }
        }

      });

      fetch('https://health.vandar.io/subscription/errors')
      .then(function(response) {
        return response.json();
      })
      .then(function(jsonResponse) {

        var errorsResponse = jsonResponse;

        var withdrawalErrorsTable = document.getElementById("withdrawal_errors_table");
        var tempAuthorizationErrorsTable = document.getElementById("tempAuthorization_errors_table");
        var errors = errorsResponse["data"];

        for (var i = 0; i < errors.length ; i++)  {
            if (errors[i]["type"] == 'withdrawal') {
                var row = withdrawalErrorsTable.insertRow(-1);
                var error_code = row.insertCell(0);
                var error_message = row.insertCell(1);

                error_code.innerHTML = errors[i]["error_code"];
                error_code.style['text-align'] = 'center';
                error_message.innerHTML = errors[i]["error_message"];
                error_message.style['text-align'] = 'right';
            }
            else if (errors[i]["type"] == 'tempMandate') {
                var row = tempAuthorizationErrorsTable.insertRow(-1);
                var error_code = row.insertCell(0);
                var error_message = row.insertCell(1);

                error_code.innerHTML = errors[i]["error_code"];
                error_code.style['text-align'] = 'center';
                error_message.innerHTML = errors[i]["error_message"];
                error_message.style['text-align'] = 'right';
            }
        }

      });


</script></body>
</html>
