<!DOCTYPE html>
<html lang="fa">
<head>
    <title>مستندات وندار | ارایه دهنده راهکارهای پرداخت</title>
    <meta name="description" content="">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <meta name="format-detection" content="telephone=no">
    <link href="https://fonts.googleapis.com/css2?family=Markazi+Text&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.rtl.css">
    <link rel='icon' href='../favicon.ico' type='image/x-icon' >
</head>
<body dir="rtl">
<header id="header">
    <h1>Vandar</h1>
    <h2>مستندات وندار</h2>
</header>

<div class="container">
    <div class="row">
        <div class="col-sm-3">
            <ul>
              <li>
                  <a href="https://vandarpay.github.io/docs/">مفاهیم اولیه</a>
              </li>
              <li>
                  <a href="https://vandarpay.github.io/docs/ipg">درگاه پرداخت</a>
              </li>
              <li>
                  <a href="https://vandarpay.github.io/docs/auth">لاگین</a>
              </li>
              <li>
                  <a href="https://vandarpay.github.io/docs/business">کسب‌وکار</a>
              </li>
              <li>
                  <a href="https://vandarpay.github.io/docs/invoice">صورت حساب</a>
              </li>
              <li>
                  <a href="https://vandarpay.github.io/docs/settlement">سرویس تسویه</a>
              </li>
              <li>
                <a href="https://vandarpay.github.io/docs/subscription" class="active">سرویس اشتراک</a>
              </li>
              <li>
                  <a href="https://vandarpay.github.io/docs/errors">خطا‌ها</a>
              </li>
            </ul>
        </div>
        <div class="col-sm-9">
            <article class="content">
                <div class="article" id="ipg">
                    <h2 class="article-header">مقدمه</h2>
                    <div>
                        <h3 class="title">
                            <strong>دایرکت دبیت یا سرویس اشتراک چیست:</strong>
                        </h3>
                        <p>سرویس اشتراک یا دایرکت دبیت سرویسی است که یک فرد وجوهی را از حساب بانکی شخص دیگری خارج میکند در واقع شما به بانک اجازه میدهید که مبلغی را مستقیما   از حسابتان کسر و در قبال آن خدماتی را به شما  ارایه دهد. به طور کلی دایرت دبیت برداشت مستقیم پول برای انجام معاملات مالی در صورت صدور مجوز توسط پرداخت کننده می باشد. این کار بیشتر زمانی انجام می شود که شما بخواهید اشتراک خود را تمدید کنید.

                            شما می توانید در وندار به وسیله این API اشتراک حساب های خود را مدیریت کنید.
                            تمامی API های وندار بر اساس معماری REST پیاده سازی شده و آدرس آن به شرح زیر می باشد:
                            </p>
                        <p>برای تمامی درخواست های ارسالی باید مقادیر زیر در هدر ارسال شوند:
                            توکن همان کلید API یی است که از وندار دریافت کرده اید.
                            </p>
                        <pre>
<span class="key">Accept:</span> application/json
<span class="key">Authorization</span> Bearer {Token}
                        </pre>
                        <h2 class="article-header">سرویس دریافت توکن (AUTHORIZATION)</h2>

                        <h3 class="title">
                            ۱. ایجاد درخواست اشتراک:
                        </h3>
                        <p>اولین مرحله از برای دریافت دسترسی به حساب بانکی و ایجاد یک اشتراک جدید. ثبت درخواست اشتراک است. لازم است که درخواست اشتراک خود را به آدرس زیر ارسال کنید.</p>
                        <pre>
<span class="key">Method:</span> POST
<span class="key">Address:</span> https://api.vandar.io/v2/business/{business}/subscription/authorization/store
                        </pre>
                        <p>مقدار ورودی باید به فرمت json و به شکل زیر با پارامتر های :</p>
                        <pre>
{
  "bank_code": "062",
  "mobile": "09123456789",
  "callback_url": "https://paperpiano.ir/subscription/callback",
  "count": 7,
  "limit": 10000,
  "name": "محمد مقصودی",
  "email": "yourcustomer@gmail.com"
}   
                        </pre>
                        <ul>
                          <li>bank_code (اجباری): کد بانک که از جدول زیر قابل دسترسی است
                            <br>
                            <table class="table">
                                <thead>
                                <tr>
                                    <th>Bank</th>
                                    <th>Code</th>
                                </tr>
                                </thead>
                                <tbody>
                                  <tr>
                                      <td>آینده</td>
                                      <td>062</td>
                                  </tr>
                                  <tr>
                                    <td>بانک ایران زمین</td>
                                    <td>069</td>
                                  </tr>
                                  <tr>
                                    <td>بانک دی</td>
                                    <td>066</td>
                                  </tr>
                                  <tr>
                                    <td>بانک انصار</td>
                                    <td>063</td>
                                  </tr>
                                  <tr>
                                    <td>بانک شهر</td>
                                    <td>061</td>
                                  </tr>
                                  <tr>
                                    <td>بانک سرمایه</td>
                                    <td>058</td>
                                  </tr>
                                  <tr>
                                    <td>بانک سامان</td>
                                    <td>056</td>
                                  </tr>
                                  <tr>
                                    <td>بانک اقتصاد نوین</td>
                                    <td>055</td>
                                  </tr>
                                  <tr>
                                    <td>پست بانک ایران</td>
                                    <td>021</td>
                                  </tr>
                                  <tr>
                                    <td>بانک سپه</td>
                                    <td>015</td>
                                  </tr>
                                  <tr>
                                    <td>بانک ملت</td>
                                    <td>012</td>
                                  </tr>
                                </tbody>
                            </table>
                          </li>
                          <li>
                            mobile (اجباری): شماره موبایل کاربر
                          </li>
                          <li>callback_url (اجباری): باید با آدرس درگاه پرداخت تایید شده در وندار بر روی یک دامنه باشد</li>
                          <li>count (اجباری): رشته عددی مشخص کننده تعداد درخواست های برداشت وجه که به صورت ماهیانه مشخص می‌شود.</li>
                          <li>limit (اجباری): شته عددی مشخص کننده حداکثر مبلغ برداشت وجه در هر برداشت. واحد پول ریال است.</li>
                          <li>name (اختیاری): نام کاربر که بهتر است برای پیگیری‌های بعدی ارسال شود</li>
                          <li>email (اختیاری): ایمیل کاربر که بهتر است برای پیگیری‌های بعدی ارسال شود.</li>
                        </ul>
                        <h3 class="sub-title">
                          نمونه خروجی موفق:
                        </h3>

                        <pre>
HTTP/1.1 2xx
{
  "status": 1,
  "message": "درخواست توکن با موفقیت ثبت شد.",
  "result": {
    "authorization": {
      "id": "0cf235d0-d48b-11ea-86cd-298ec898a9bd"
    }
  }
}
                        </pre>
                        <div class="info">
                          <strong>نکته! </strong>توکن دریافتی در این قسمت یکبار مصرف می باشد .
                        </div>
                      <h3 class="sub-title">
                        نمونه خروجی نا موفق:
                      </h3>
                      <pre>
<span class="key">HTTP/1.1</span> 4xx
{
  "status": 0,
  "error": "Unauthenticated"
}
                        </pre>

                        <ul>
                          <li>status: مقدار 0 و 1 دارد که نشان دهنده موفقیت آمیز بودن درخواست است</li>
                          <li>errors: آرایه ای از خطا‌ها</li>
                        </ul>
                      <h3 class="title">
                        ۲. انتقال کاربر به صفحه بانک
                      </h3>
                      <p>
                        در مرحله بعد uuid دریافتی از قسمت قبل را در انتهای https://subscription.vandar.io/authorizations/{uuid} میگذاریم و در بروزر وارد سایت میشویم.
                      </p>
                      <pre>
<span class="key">METHOD:</span> get
<span class="key">URL:</span> https://subscription.vandar.io/authorizations/{uuid}
                      </pre>

<img src="../images/authorize-intro.png" alt="صفحه ورود بانک">
<p>با وارد کردن کد ملی و گذر واژه صحیح وارد صفحه زیر می شویم.</p>
<img src="../images/authorize.png" alt="صفحه دسترسی">
<h3 class="title">
  ۳. دریافت کد اشتراک
</h3>
<p>در صورتی که کاربر بر روی دکمه دسترسی دارد کلیک کند، وندار کاربر را به آدرس برگشتی که در مرحله اول ارسال کرده‌اید به همراه پارامتر subscription_code و status هدایت می‌کند. نمونه موفق:</p>
<img src="../images/authorize-callback.png" alt="بازگشت موفق">
<p>نمونه ناموفق</p>
<img src="../images/authorize-callback.png" alt="بازگشت ناموفق">

<h3 class="title">
  ۴. لیست اشتراک‌ها
</h3>
<p>نمونه درخواست دریافت لیست اشتراک‌ها:</p>
<pre>
<span class="key">METHOD:</span> GET
<span class="key">URL:</span> https://api.vandar.io/v2/business/{business}/subscription/authorization
</pre>
<p>پاسخ دریافتی موفق:</p>
<pre>
<span class="key">HTTP/1.1</span> 200
{
  "data": [
    {
      "id": "b4d32590-d426-11ea-b5b5-0b0e1f82ac3c",
      "customer_uuid": "b4d1e440-d426-11ea-a9d3-051cbf7b8f81",
      "temp_authorization_uuid": "96ff2c90-d426-11ea-b499-6ddbc3441df4",
      "application_id": 2,
      "success_code": "qCWkzcpSy43Mz2iJ",
      "bank_code": "062",
      "callback_url": "http:\/\/vandar.ui\/dd\/callback.php",
      "count": 7,
      "limit": "10200",
      "mobile": "09129311989",
      "name": "محمد مقصودی",
      "email": "customer.email@gmail.com",
      "scopes": [
        "oak:withdrawal-from:execute"
      ],
      "monthly_call_limitation": "7",
      "max_amount_per_transaction": "10200",
      "national_code": "2993968416",
      "creation_datetime": "13990511231209",
      "type": "CODE",
      "lifetime": "864000000",
      "deposits": [
        "0203214109001"
      ],
      "client_id": "vandario",
      "payman_code": null,
      "payman_id": null,
      "count_daily": null,
      "start_date": null,
      "expiration_date": null
    },
    ...
  ],
  "links": {
    "first": "http:\/\/dd.vandar.io\/api\/v1\/vandario\/authorizations?page=1",
    "last": "http:\/\/dd.vandar.io\/api\/v1\/vandario\/authorizations?page=1",
    "prev": null,
    "next": null
  },
  "meta": {
    "current_page": 1,
    "from": 1,
    "last_page": 1,
    "path": "http:\/\/dd.vandar.io\/api\/v1\/vandario\/authorizations",
    "per_page": 20,
    "to": 3,
    "total": 3
  }
}
</pre>
<h3 class="sub-title">
  ۵. نمایش یک اشتراک با uuid 
</h3>
<pre>
  <span class="key">Method:</span> GET
  <span class="key">Address:</span> https://api.vandar.io/v2/business/{business}/subscription/authorization/{uuid}
                          </pre>
<h3 class="sub-title">
                              خروجی موفق:
</h3>
<pre>
  <span class="key">Content-Type:</span> application/json
  <span class="key">Authorization</span> Bearer {Token}
                          </pre>
<h3 class="sub-title">
  خروجی ناموفق در صورت عدم قرار دادن کسب و کار صحیح در url :
</h3>
<pre>
<span class="key">Content-Type:</span> application/json
<span class="key">Authorization</span> Bearer {Token}
</pre>

<h3 class="sub-title">
  ۶. پاک کردن یک اشتراک با استفاده از uuid 
</h3>

<pre>
  <span class="key">Method:</span> DELETE
  <span class="key">Address:</span> https://api.vandar.io/v2/business/{business}/subscription/authorization/{uuid}
</pre>

<h3 class="sub-title">
  خروجی موفق:
</h3>


<h3 class="sub-title">
  خروجی ناموفق در صورت وارد کردن توکن ناصحیح:
</h3>

<h2 class="article-header">سرویس برداشت وجه از (Withdrawal)</h2>

<p>سرویس برداشت وجه از حساب دیگران, این سرویس هنگامی به کار می‌رود که شما قصد دارید از حساب مشتریان خود یکبار یا به صورت دوره‌ای وجهی را برداشت کنید.</p>

<h3 class="title">
  ۱. ایجاد برداشت وجه تا سقف count تعیین شده در قسمت authorization (این متد را به تعداد count میتوان صدا زد )  
</h3>

<pre>
  <span class="key">Method:</span> DELETE
  <span class="key">Address:</span> https://api.vandar.io/v2/business/{business}/subscription/authorization/{uuid}
</pre>

<p>
  مقدار ورودی باید مقادیر زیر باشد.
</p>

<pre>
  <span class="key">Method:</span> DELETE
  <span class="key">Address:</span> https://api.vandar.io/v2/business/{business}/subscription/authorization/{uuid}
</pre>

<p>مقدار ورودی باید به فرمت json و به شکل زیر با پارامتر های :</p>

<p style="text-align: right: ;;">
  business_id => آیدی بیزینس <br>
  authorization_id => مقدار id دریافتی در قسمت authorization  ,<br>
  amount =>   مقدار برداشت از حساب,<br>
  withdrawal_date => تاریخ امروز به بعد,<br>
</p>

<h3 class="sub-title">
  مقدار خروجی موفق:
</h3>

<pre>
  <span class="key">HTTP/1.1</span> 4xx
  {
    "status": 0,
    "error": "Unauthenticated"
  }
</pre>

<p>مقدار خروجی نا موفق بعد از تکرار بیشتر از count :</p>

<p>صدا زدن این api تا تعداد count ها ادامه پیدا میکند در صورت بیشتر شدن از تعداد count ها با خطای زیر مواجه میشویم..
</p>

<pre>
  <span class="key">HTTP/1.1</span> 4xx
  {
    "status": 0,
    "error": "Unauthenticated"
  }
</pre>

<p>مقدار خروجی ناموفق در صورت ورود توکن نادرست:</p>

<pre>
  <span class="key">HTTP/1.1</span> 4xx
  {
    "status": 0,
    "error": "Unauthenticated"
  }
</pre>

<p>توکن نا درست در صورت ورود url نادرست:</p>

<pre>
  <span class="key">HTTP/1.1</span> 4xx
  {
    "status": 0,
    "error": "Unauthenticated"
  }
</pre>

<h3 class="sub-title">
  ۲.برای مشاهده تمامی برداشت های وجه ثبت شده از api زیر استفاده میکنیم

</h3>

<pre>
  <span class="key">Method:</span> DELETE
  <span class="key">Address:</span> https://api.vandar.io/v2/business/{business}/subscription/authorization/{uuid}
</pre>

<p>با استفاده از api بالا می توان تمام برداشت های وجه انجام شده تا کنون را می توان مشاهده کرد </p>

<h3 class="sub-title">
  مقدار خروجی موفق:
</h3>

<pre>
  <span class="key">HTTP/1.1</span> 200
  {
    "status": 1,
    "data": {
      "wallet": 26099,
      "blocked_amount": 0,
      "deductible_amount": 26099,
      "currency": "Toman",
      "settlements": {
        "data": [
          {
            "id": "8edaa0a0-a33f-11ea-838d-676dce32760e",
            "iban_id": 22822, <!--TODO: Is it right?-->
            "gateway_transaction_id": 159024236678,
            "amount": 100000,
            "payment_number": null,
            "status": "CANCELED",
            "wallet": 160985,
            "settlement_date": "2020-05-31"
          },
          {
            "id": "807003f0-8398-11ea-a42b-ede62b9de0c1",
            "iban_id": 902,
            "gateway_transaction_id": 158745010355,
            "amount": 50000,
            "payment_number": null,
            "status": "DONE",
            "wallet": 99485,
            "settlement_date": "2020-04-21"
          },
          {
            "id": "010a7850-82ff-11ea-85bd-49ef214903e3",
            "iban_id": 902,
            "gateway_transaction_id": 158738422601,
            "amount": 68000000,
            "payment_number": null,
            "status": "DONE",
            "wallet": 126485,
            "settlement_date": "2020-04-21"
          },
          {
            "id": "53665740-82cf-11ea-baf3-95ebee6a9eca",
            "iban_id": 26,
            "gateway_transaction_id": 158736374134,
            "amount": 15000000,
            "payment_number": null,
            "status": "CANCELED",
            "wallet": 43126485,
            "settlement_date": "2020-04-21"
          },
          {
            "id": "456afdb0-82cf-11ea-8e13-3183b5b1630b",
            "iban_id": 7215,
            "gateway_transaction_id": 158736367341,
            "amount": 5000000,
            "payment_number": null,
            "status": "CANCELED",
            "wallet": 58126485,
            "settlement_date": "2020-04-21"
          }
        ],
        "first": "https:\/\/api.settlement.vandar.io\/v1\/settlements?page=1",
        "last": "https:\/\/api.settlement.vandar.io\/v1\/settlements?page=19",
        "prev": null,
        "next": "https:\/\/api.settlement.vandar.io\/v1\/settlements?page=2",
        "current_page": 1,
        "from": 1,
        "last_page": 19,
        "path": "https:\/\/api.settlement.vandar.io\/v1\/settlements",
        "per_page": 5,
        "to": 5,
        "total": 93
      }
    }
  }
  </pre>

  <h3 class="sub-title">
      خروجی ناموفق در صورت وارد کردن توکن نا مناسب:
  </h3>

  <pre>
      <span class="key">HTTP/1.1</span> 200
      {
        "status": 1,
        "data": {
          "settlement": [
            {
              "id": "b6c72d20-a4ba-11ea-8a6c-9dc8b4b708ac",
              "iban_id": "b6b5c440-a4ba-11ea-837b-bf6e427ec6d0",
              "transaction_id": 159100434426,
              "amount": 50000,
              "payment_number": null,
              "status": "PENDING",
              "wallet": 60985,
              "settlement_date": "2020-06-02",
              "settlement_date_jalali": "1399\/03\/13"
            }
          ]
        }
      }
      </pre>

      <h3 class="sub-title">
          ۳. نمایش یک برداشت:
      </h3>

      <pre>
          <span class="key">METHOD:</span> POST
          <span class="key">URL:</span> https://api.vandar.io/v2.1https://api.vandar.io/v2/business/{business}/settlement/store
      </pre>

      <p>برای نمایش یک برداشت باید با استفاده از id دریافتی در api مربوط به نمایش تمامی برداشت های وجه در مرحله قبل آن را در انتهای url قرار داد.</p>

      <h3 class="sub-title">
          خروجی موفق:
      </h3>

      <pre>
          <span class="key">HTTP/1.1</span> 200
          {
            "status": 1,
            "data": {
              "settlement": [
                {
                  "id": "b6c72d20-a4ba-11ea-8a6c-9dc8b4b708ac",
                  "iban_id": "b6b5c440-a4ba-11ea-837b-bf6e427ec6d0",
                  "transaction_id": 159100434426,
                  "amount": 50000,
                  "payment_number": null,
                  "status": "PENDING",
                  "wallet": 60985,
                  "settlement_date": "2020-06-02",
                  "settlement_date_jalali": "1399\/03\/13"
                }
              ]
            }
          }
          </pre>

          <h3 class="sub-title">
              خروجی ناموفق در صورت وارد کردن توکن نادرست:
          </h3>

          <pre>
              <span class="key">METHOD:</span> POST
              <span class="key">URL:</span> https://api.vandar.io/v2.1https://api.vandar.io/v2/business/{business}/settlement/store
          </pre>

          <h3 class="sub-title">
              خروجی ناموفق در صورت وارد کردن کسب و کار نادرست در url:
          </h3>

          <pre>
              <span class="key">METHOD:</span> POST
              <span class="key">URL:</span> https://api.vandar.io/v2.1https://api.vandar.io/v2/business/{business}/settlement/store
          </pre>

          <h3 class="sub-title">
              ۴. انصراف از برداشت وجه:
          </h3>

          <p>در صورتی که کاربر از برداشت وجه منصرف شود با صدا زدن متد زیر می تواند انصراف خود را اعلام کند.</p>

          <pre>
              <span class="key">METHOD:</span> POST
              <span class="key">URL:</span> https://api.vandar.io/v2.1https://api.vandar.io/v2/business/{business}/settlement/store
          </pre>


          <h3 class="sub-title">
              خروجی موفق:
          </h3>

          <pre>
              <span class="key">HTTP/1.1</span> 200
              {
                "status": 1,
                "data": {
                  "settlement": [
                    {
                      "id": "b6c72d20-a4ba-11ea-8a6c-9dc8b4b708ac",
                      "iban_id": "b6b5c440-a4ba-11ea-837b-bf6e427ec6d0",
                      "transaction_id": 159100434426,
                      "amount": 50000,
                      "payment_number": null,
                      "status": "PENDING",
                      "wallet": 60985,
                      "settlement_date": "2020-06-02",
                      "settlement_date_jalali": "1399\/03\/13"
                    }
                  ]
                }
              }
              </pre>

              <h3 class="sub-title">
                  خروجی ناموفق در صورت ورود توکن نا درست:
              </h3>

              <pre>
                  <span class="key">HTTP/1.1</span> 200
                  {
                    "status": 1,
                    "data": {
                      "settlement": [
                        {
                          "id": "b6c72d20-a4ba-11ea-8a6c-9dc8b4b708ac",
                          "iban_id": "b6b5c440-a4ba-11ea-837b-bf6e427ec6d0",
                          "transaction_id": 159100434426,
                          "amount": 50000,
                          "payment_number": null,
                          "status": "PENDING",
                          "wallet": 60985,
                          "settlement_date": "2020-06-02",
                          "settlement_date_jalali": "1399\/03\/13"
                        }
                      ]
                    }
                  }
                  </pre>

                  <h3 class="sub-title">
                      خروجی ناموفق در صورت وارد کردن کسب و کار نادرست در url:
                  </h3>

                  <pre>
                      <span class="key">HTTP/1.1</span> 200
                      {
                        "status": 1,
                        "data": {
                          "settlement": [
                            {
                              "id": "b6c72d20-a4ba-11ea-8a6c-9dc8b4b708ac",
                              "iban_id": "b6b5c440-a4ba-11ea-837b-bf6e427ec6d0",
                              "transaction_id": 159100434426,
                              "amount": 50000,
                              "payment_number": null,
                              "status": "PENDING",
                              "wallet": 60985,
                              "settlement_date": "2020-06-02",
                              "settlement_date_jalali": "1399\/03\/13"
                            }
                          ]
                        }
                      }
                      </pre>
                      </div>
                    </article>
              </div>
          </div>
      </div>
  <footer id="footer">
    <div class="container">
        <div class="row" style="text-align: center">
            <div class="col-sm-8 col-xs-6 no-padding-bottom">
                <a href="https://github.com/vandarpay/docs" target="_blank">مخزن گیت‌هاب</a>
            </div>
            <div class="col-sm-4 col-xs-6 text-right no-padding-bottom">2020 &copy; <a href="https://vandar.io" target="_blank">وندار</a></div>
        </div>
    </div>

</footer>
<button onclick="goTop()" id="go_top" title="Go to top">^</button>
<script>
    window.onscroll = function() {
        var top = document.getElementById("go_top");
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            top.style.display = "block";
        } else {
            top.style.display = "none";
        }
    };

    function goTop() {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    };
</script>
</body>
</html>
