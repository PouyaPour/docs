<!DOCTYPE html>
<html lang="fa">
<head>
    <title>مستندات وندار | ارایه دهنده راهکارهای پرداخت</title>
    <meta name="description" content="">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <meta name="format-detection" content="telephone=no">
    <link href="https://fonts.googleapis.com/css2?family=Markazi+Text&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.rtl.css">
    <link rel='icon' href='../favicon.ico' type='image/x-icon' >
</head>
<body dir="rtl">
<header id="header">
    <h1>Vandar</h1>
    <h2>مستندات وندار</h2>
</header>

<div class="container">
    <div class="row">
        <div class="col-sm-3">
            <ul>
              <li>
                  <a href="https://vandarpay.github.io/cpg/">درگاه پرداخت قسطی</a>
              </li>
            </ul>
        </div>
        <div class="col-sm-9">
                <article class="content">
                    <div class="article" id="ipg">
                        <h2 class="article-header">درگاه پرداخت قسطی</h2>
                        <div>
                            <h3 class="title">
                                <strong>مقدمه</strong>
                            </h3>
                            <p>برای فروشـگاه‌های اینترنتی که خدمات یا محصولاتی را در وب‌سـایت خود ارائه می‌کنـند، از درگاه پرداخت وندار استفاده کنید.</p>
                            <p>قبل از شروع پیاده سازی بهتر است یک بار فرایند پرداخت را با هم مرور کنیم.</p>
                            <ul>
                                <li>مرحله اول: ارسال اطلاعات تراکنش توسط فروشگاه به وندار و دریافت توکن پرداخت.</li>
                                <li>مرحله دوم: انتقال کاربر توسط فروشگاه به صفحه ورود لندو با توکنی که در مرحله قبل از وندار دریافت کرده است.</li>
                                <li>مرحله سوم : وارد کردن شماره تماس کاربر و دریافت کد ۶ رقمی در صورت داشتن حساب کاربری در لندو .</li>
                                <li>مرحله چهارم : وارد کردن کد ۶ رقمی توسط کاربر و دریافت اطلاعات خود از لندو .</li>
                                <li>مرحله پنجم : با زدن دکمه پرداخت در صورت داشتن مبلغ کافی در لندو از حساب کاربر کسر میشود و در غیر اینصورت با زدن دکمه پرداخت الباقی مبلغ در درگاه شاپرک توسط کاربر پرداخت میشود  .</li>
                                <li>مرحله ششم :ارسال کاربر به فروشگاه .</li>
                                <li>مرحله هفتم :تایید تراکنش .</li>
                            </ul>

                        </div>
                        <div>
                            <h3 class="title">
                                <strong>مرحله اول:</strong> ارسال اطلاعات و دریافت توکن
                            </h3>
                            <p>در مرحله اول باید پارامترهای موجود در جدول زیر را با متد POST به آدرسی که مشخص شده ارسال کنید. به نوع داده‌ها و نام فیلد توجه کنید. اگر برای فیلد شماره موبایل، شماره موبایل کاربر را به درگاه ارسال نمایید، کاربر به صورت خودکار به صفحه پرداخت درگاه موبایلی هدایت می‌شود، به این معنی که در صفحه‌ی درگاه پرداخت بر مبنای شماره موبایل کاربر فهرست کارت‌های ذخیره شده‌اش در PSP نمایش داده می‌شود.</p>
                            <pre>
<span class="key">METHOD:</span> post
<span class="key">URL:</span> https://cpg.vandar.ir/api/v1/cpg/send
                            </pre>
                            <h3 class="sub-title">
                                پارامترهای مجاز
                            </h3>
                            <table>
                                <tr>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                </tr>
                                <tr>
                                    <td>api_key</td>
                                    <td>string</td>
                                    <td>required</td>
                                </tr>
                                <tr>
                                    <td>amount</td>
                                    <td>Integer</td>
                                    <td>required</td>
                                </tr>
                                <tr>
                                    <td>callback_url</td>
                                    <td>String</td>
                                    <td>required</td>
                                </tr>
                                <tr>
                                    <td>mobile_number</td>
                                    <td>String</td>
                                    <td>optional</td>
                                </tr>
                                <tr>
                                    <td>factorNumber(optional)</td>
                                    <td>String</td>
                                    <td>optional</td>
                                </tr>
                                <tr>
                                    <td>description(optional)</td>
                                    <td>String</td>
                                    <td>optional</td>
                                </tr>
                            </table>
                            <h3 class="sub-title">
                                توضیحات
                            </h3>
                            <ul>
                                <li>api_key (اجباری): این کلید بعد از ساخت درگاه پرداخت صادر می‌شود. برای دریافت این کلید به داشبورد وندار مراجعه کنید</li>
                                <li>amount (اجباری): مبلغ تراکنش به صورت ریالی و بزرگتر یا مساوی 1000</li>
                                <li>callback_url (اجباری): باید با آدرس درگاه پرداخت تایید شده در وندار بر روی یک دامنه باشد</li>
                                <li>mobile_number (اختیاری): شماره موبایل (اختیاری، جهت نمایش کارت های خریدار به ایشان و نمایش درگاه موبایلی )</li>
                                <li>factorNumber (اختیاری): شماره فاکتور شما (اختیاری)</li>
                                <li>description (اختیاری): توضیحات (اختیاری، حداکثر 255 کاراکتر)</li>
                            </ul>
                            <h3 class="sub-title">
                                نمونه json
                            </h3>
                            <pre>
{
    "<span class="key">api_key</span>": "کلید درگاه پرداخت دریافتی از پنل",
    "<span class="key">amount</span>": 1000,
    "<span class="key">callback_url</span>": "https://example.com/callback",
    "<span class="key">mobile_number</span>": "09123456789",
    "<span class="key">factorNumber</span>": "12345",
    "<span class="key">description</span>": "توضیحات دلخواه",
}
                            </pre>
                            <h3 class="sub-title">
                                نمونه پاسخ دریافتی موفق
                            </h3>
                            <pre>
<span class="key">HTTP/1.1</span> 200
{
    "<span class="key">status</span>": 1,
    "<span class="key">token</span>": "توکن پرداختی که در مراحل بعدی مورد استفاده قرار می‌گیرد.",
}
                            </pre>
                            <ul>
                                <li>status: مقدار 0 و 1 دارد که نشان دهنده موفقیت آمیز بودن درخواست است</li>
                                <li>token: یک رشته از حروف و اعداد است با طول متغییر، که توکن پرداخت است و باید سمت پذیرنده نگهداری شود.</li>
                            </ul>
                            <h3 class="sub-title">
                                نمونه پاسخ دریافتی ناموفق
                            </h3>
                            <pre>
<span class="key">HTTP/1.1</span> 4xx
{
    "<span class="key">status</span>": 0,
    "<span class="key">errors</span>": [
        "وارد کردن api key الزامی است",
        "api_key معتبر نیست",
        "IP پذیرنده معتبر نیست",
        "وارد کردن callback_url الزامی است",
        "callback_url معتبر نیست",
        "وارد کردن amount الزامی است",
        "amount نباید کوچکتر از 1000 باشد",
        "amount باید عدد یا رشته‌ای از اعداد باشد",
    ]
}
                            </pre>
                            <ul>
                                <li>status: مقدار 0 و 1 دارد که نشان دهنده موفقیت آمیز بودن درخواست است</li>
                                <li>errors: آرایه ای از خطا‌ها</li>
                            </ul>
                        </div>

                        <h3 class="title">
                            <strong>مرحله دوم:</strong> انتقال کاربر به صفحه ورود لندو
                        </h3>
                        <p>اگر در مرحله ارسال اطلاعات، اطلاعات ارسالی صحیح باشد و دو مقدار status و token را دریافت کرده باشید. باید کاربر را به شیوه‌ی زیر به صفحه ورود لندو هدایت کنید. برای این کار باید عددی که در مرحله اول در متغیر {token} دریافت کردید را در آخر آدرس قرار دهید و کاربر را به URL ایجاد شده redirect کنید تا بلافاصله کاربر به فرم مربوط به لندو برای ارسال شماره تلفن هدایت شود و سپس مرحله سوم را انجام دهید.</p>
                        <pre>
<span class="key">METHOD:</span> get
<span class="key">URL:</span> https://cpg.vandar.ir/v1/cpg/{token}
                        </pre>


                        <div class="info">
                            <strong>نکته!</strong> اگر فروشگاه به درستی این مرحله را انجام بدهد کاربر به صفحه ورود لندو منتقل میشود.
     </div>

                        <h3 class="title">
                            <strong>مرحله سوم:</strong>وارد کردن شماره تماس کاربر
                        </h3>
                        <p>در صورتی که کاربر از قبل در لندو ثبت نام کرده باشد برایش کد ارسال میشود و در غیر اینصورت خطای "این شماره تماس در لندو موجود نمیباشد" را دریافت میکند.</p>

                        <h3 class="title">
                            <strong>مرحله چهارم:</strong>وارد کردن کد ۶ رقمی توسط کاربر
                        </h3>
                        <p>در این مرحله کاربر کد ۶ رقمی ارسال شده را وارد میکند</p>


                        <ul>
                            <li>در صورت وارد کردن کد صحیح ،کاربر به صفحه حاوی اطلاعات خود که نشان میدهد چقدر اعتبار در لندو (موجودی کیف پول) دارد و چقدر باید پرداخت کند!(در صورتی که مبلغ خرید کمتر از موجودی کیف پول باشد دیگر نیازی به رفتن به درگاه بانکی و پرداخت نیست!) </li>

                        </ul>

                        <h3 class="title">
                            <strong>مرحله پنجم:</strong>ارسال کاربر به فرم تکمیل فرایند خرید
                        </h3>
                        <p>در این مرحله اگر کاربر باید مبلغ اضافه تری نسبت به کیف پول پرداخت کند به درگاه هدایت میشود و سپس به این صفحه بر میگردد در غیر اینصورت با زدن دکمه پرداخت از اعتبار لندو او کسر میشود بعد از پرداخت موفق در شاپرک کاربر میتواند رسید تراکنش خود را دریافت کند.</p>

                        <h3 class="title">
                            <strong>مرحله ششم:</strong>ارسال کاربر به فروشگاه
                        </h3>
                        <p>در این مرحله با زدن دکمه تکمیل فرایند خرید به سایت فروشگاهی که خرید از آن انجام شده بود هدایت می شود با این تفاوت که در انتهای آدرس بازگشتی  token و payment_status وجود دارد.</p>
                        <div class="info">
                            <strong>نکته!</strong>بعد از بازگشت دو پارامتر token و payment_status به انتهای آدرس بازگشتی اضافه شده است. مانند تصویر زیر.
                            <br>
                            <img src="../images/ipg-callback.png" alt="آدرس بازگشتی">
                            اگر payment_status مقداری غیر از OK داشت همینجا می‌توانید فرایند پرداخت را متوقف کنید و پول کسر شده از کاربر به حساب او بر میگردد. اما اگر OK (با حروف بزگ) بود فروشگاه باید فرایند خرید را تایید کند و به مرحله بعد برود!.
                        </div>

                        <h3 class="title">
                            <strong>مرحله هفتم:</strong> تایید تراکنش
                        </h3>
                        <p>آخرین مرحله و تمام کننده یک چرخه پرداخت در شبکه پرداخت وندار تایید تراکنش است. مهمترین نکته این مرحله این است که این سرویس به ازای هر تراکنش و برای جلوگیری از تکرار تراکنش <strong>فقط و فقط یک بار</strong> پاسخ می‌دهد.</p>

                        <pre>
<span class="key">METHOD:</span> post
<span class="key">URL:</span> https://cpg.vandar.ir/api/v1/cpg/verify
                        </pre>

                        <h3 class="sub-title">
                            پارامترهای مجاز
                        </h3>
                        <table>
                            <tr>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Status</th>
                            </tr>
                            <tr>
                                <td>api_key</td>
                                <td>string</td>
                                <td>required</td>
                            </tr>
                            <tr>
                                <td>token</td>
                                <td>string</td>
                                <td>required</td>
                            </tr>
                        </table>
                        <h3 class="sub-title">
                            توضیحات
                        </h3>
                        <ul>
                            <li>api_key (اجباری): این کلید بعد از ساخت درگاه پرداخت صادر می‌شود. برای دریافت این کلید به داشبورد وندار مراجعه کنید</li>
                            <li>token (اجباری): همان توکن پرداختی که در مرحله یک دریافت کردید و در این مرحله به انتهای آدرس بازگشتی اضافه شده است.</li>
                        </ul>
                        <h3 class="sub-title">
                            نمونه پاسخ دریافتی موفق
                        </h3>
                        <pre>
<span class="key">HTTP/1.1</span> 200
{
    "status": 1,
    "amount": "1000.00",
    "realAmount": 500,
    "wage": "500",
    "transId": 159178352177,
    "factorNumber": "12345",
    "mobile": "09123456789",
    "description": "description",
    "cardNumber": "603799******7999",
    "paymentDate": "2020-06-10 14:36:30",
    "cid": null,
    "message": "ok"
}
                        </pre>
                        <ul>
                            <li>status: مقدار 0 و 1 دارد که نشان دهنده موفقیت آمیز بودن درخواست است</li>
                            <li>amount: مبلغ تراکنش که ممکن است با مبلغ تراکنشی که در مرحله اول ارسال کرده باشید متفاوت باشد. اگر کارمزد تراکنش بر عهده پرداخت کننده باشد. مبلغ کارمزد هم به مبلغ تراکنش ارسالی از سمت شما اضافه شده است.</li>
                            <li>realAmount: مبلغی که بر اساس این تراکنش کیف پول شما بالا رفته است.</li>
                            <li>wage: کارمزد تراکنش</li>
                            <li>transId: شناسه یکتای پرداخت که برای پیگیری تراکنش از وندار مورد استفاده قرار می‌گیرد.</li>
                            <li>factorNumber: شماره فاکتوری که شما در مرحله اول ارسال کردید.</li>
                            <li>mobile: شماره موبایل پرداخت کننده که در حرحله اول ارسال کردید.</li>
                            <li>description: توضیحاتی که شما در مرحله اول ارسال کردید.</li>
                            <li>cardNumber: ماسکه شده شماره کارت پرداخت کننده.</li>
                            <li>paymentDate: تاریخ انجام تراکنش.</li>
                            <li>cid: هش شماره کارت که با الگوریتم SHA256 هش شده است.</li>
                            <li>message: وضعیت تراکنش</li>
                        </ul>
                        <h3 class="sub-title">
                            نمونه پاسخ دریافتی ناموفق
                        </h3>
                        <pre>
<span class="key">HTTP/1.1</span> 4xx
{
    "status": 0,
    "errors": [
      "نتیجه تراکنش قبلا از طرف وندار اعلام گردیده.",
      "وارد کردن api key الزامی است",
      "api_key معتبر نیست",
      "IP پذیرنده معتبر نیست",
      "وارد کردن token الزامی است",
      "token معتبر نیست",
      "تراکنش با خطا مواجه شده است"
    ]
}
                        </pre>
                        <ul>
                            <li>status: مقدار 0 و 1 دارد که نشان دهنده موفقیت آمیز بودن درخواست است</li>
                            <li>errors: آرایه ای از خطا‌ها</li>
                        </ul>
                    </div>
                </article>
        </div>
    </div>
</div>

<footer id="footer">
    <div class="container">
        <div class="row" style="text-align: center">
            <div class="col-sm-8 col-xs-6 no-padding-bottom">
                <a href="https://github.com/vandarpay/docs" target="_blank">مخزن گیت‌هاب</a>
            </div>
            <div class="col-sm-4 col-xs-6 text-right no-padding-bottom">2020 &copy; <a href="https://vandar.io" target="_blank">وندار</a></div>
        </div>
    </div>

</footer>
<button onclick="goTop()" id="go_top" title="Go to top">^</button>
<script>
    window.onscroll = function() {
        var top = document.getElementById("go_top");
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            top.style.display = "block";
        } else {
            top.style.display = "none";
        }
    };

    function goTop() {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    };
</script>
</body>
</html>
